<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bet the Bracket - Full Interactive Bracket</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: white;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            padding: 20px 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        .nav-section {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .tab-btn {
            padding: 10px 24px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .tab-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.4);
        }
        
        .tab-btn.active {
            background: white;
            color: #1e3a8a;
            border-color: white;
        }
        
        .stats-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .title {
            font-size: 24px;
            font-weight: 700;
        }
        
        .stats {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .stat {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        
        .stat-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.8;
            margin-bottom: 2px;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: 700;
        }
        
        .stat-value.highlight {
            color: #10b981;
        }
        
        .controls {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .btn-reset {
            background: #ef4444;
            color: white;
        }
        
        .btn-reset:hover {
            background: #dc2626;
        }
        
        .btn-auto {
            background: #8b5cf6;
            color: white;
        }
        
        .btn-auto:hover {
            background: #7c3aed;
        }
        
        .bracket-container {
            padding: 30px;
            overflow: auto;
        }
        
        .bracket-wrapper {
            display: flex;
            gap: 40px;
            min-width: max-content;
            margin: 0 auto;
            max-width: 1800px;
        }
        
        .region-half {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .region {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #334155;
        }
        
        .region-header {
            text-align: center;
            font-size: 18px;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .region-bracket {
            display: flex;
            gap: 20px;
        }
        
        .round {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            min-width: 180px;
        }
        
        .round-label {
            text-align: center;
            font-size: 11px;
            font-weight: 600;
            color: #94a3b8;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .matchup {
            background: #1e293b;
            border-radius: 8px;
            border: 2px solid #334155;
            overflow: hidden;
            margin: 10px 0;
            transition: all 0.2s;
        }
        
        .matchup:hover {
            border-color: #3b82f6;
        }
        
        .matchup.selected {
            border-color: #10b981;
        }
        
        .team-slot {
            padding: 8px 10px;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid #334155;
            min-height: 42px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .team-slot:last-child {
            border-bottom: none;
        }
        
        .team-slot:hover {
            background: #2d3748;
        }
        
        .team-slot.selected {
            background: #1e40af;
        }
        
        .team-slot.locked {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .team-slot.empty {
            opacity: 0.3;
            justify-content: center;
        }
        
        .team-slot.empty:hover {
            background: #1e293b;
        }
        
        .team-info {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }
        
        .seed {
            background: #475569;
            color: white;
            min-width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
        }
        
        .team-slot.selected .seed {
            background: #3b82f6;
        }
        
        .team-name {
            font-size: 13px;
            font-weight: 600;
        }
        
        .placeholder {
            font-size: 12px;
            color: #64748b;
            text-align: center;
        }
        
        .pricing-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 2px;
            margin-left: 8px;
        }
        
        .prob {
            font-size: 10px;
            color: #94a3b8;
        }
        
        .payout {
            font-size: 12px;
            font-weight: 700;
            color: #10b981;
        }
        
        .final-four-section {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 30px;
            min-width: 200px;
        }
        
        .final-four-label {
            text-align: center;
            font-size: 20px;
            font-weight: 700;
            color: #3b82f6;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .championship-game {
            background: rgba(59, 130, 246, 0.1);
            border: 2px solid #3b82f6;
            border-radius: 12px;
            padding: 15px;
        }
        
        .champion-slot {
            background: #1e293b;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 2px solid #10b981;
        }
        
        .champion-label {
            font-size: 12px;
            color: #94a3b8;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .champion-team {
            font-size: 18px;
            font-weight: 700;
            color: #10b981;
        }
        
        .instructions {
            text-align: center;
            padding: 20px;
            color: #94a3b8;
            font-size: 14px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .table-container {
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .table-title {
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-bottom: 10px;
        }
        
        .table-subtitle {
            text-align: center;
            color: #94a3b8;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .prob-table {
            width: 100%;
            background: #1e293b;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #334155;
        }
        
        .prob-table th {
            background: #334155;
            color: #e2e8f0;
            padding: 12px;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .prob-table td {
            padding: 12px;
            text-align: center;
            border-top: 1px solid #334155;
            font-size: 13px;
        }
        
        .prob-table tr:hover {
            background: #2d3748;
        }
        
        .seed-col {
            font-weight: 700;
            color: #3b82f6;
            font-size: 16px;
        }
        
        .prob-cell {
            color: #94a3b8;
        }
        
        .payout-cell {
            color: #10b981;
            font-weight: 600;
        }
        
        .capped {
            color: #f59e0b;
            font-weight: 700;
        }
        
        .capital-container {
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .capital-title {
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-bottom: 10px;
        }
        
        .capital-subtitle {
            text-align: center;
            color: #94a3b8;
            margin-bottom: 40px;
            font-size: 14px;
        }
        
        .capital-section {
            background: #1e293b;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid #334155;
        }
        
        .section-header {
            font-size: 18px;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #334155;
        }
        
        .capital-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .capital-card {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 20px;
        }
        
        .capital-card-label {
            font-size: 12px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .capital-card-value {
            font-size: 28px;
            font-weight: 700;
            color: white;
        }
        
        .capital-card-value.green {
            color: #10b981;
        }
        
        .capital-card-value.red {
            color: #ef4444;
        }
        
        .capital-card-value.yellow {
            color: #f59e0b;
        }
        
        .capital-description {
            font-size: 13px;
            color: #cbd5e1;
            margin-top: 8px;
            line-height: 1.5;
        }
        
        .scenario-input {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .input-label {
            font-size: 12px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .input-field {
            padding: 10px 15px;
            background: #0f172a;
            border: 2px solid #334155;
            border-radius: 6px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            width: 150px;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .formula-box {
            background: rgba(15, 23, 42, 0.5);
            border-left: 4px solid #3b82f6;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        
        .formula-text {
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #cbd5e1;
            line-height: 1.6;
        }
        
        @media (max-width: 1400px) {
            .bracket-wrapper {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="nav-section">
                <div class="title" style="margin-right: 30px;">üèÄ Bet the Bracket</div>
                <button class="tab-btn active" onclick="switchTab('bracket')">Interactive Bracket</button>
                <button class="tab-btn" onclick="switchTab('probabilities')">Probability Table</button>
                <button class="tab-btn" onclick="switchTab('capital')">Capital Calculator</button>
            </div>
            
            <div class="stats-section">
                <div class="stats">
                    <div class="stat">
                        <div class="stat-label">Entry Cost</div>
                        <div class="stat-value" id="entryCost">$63.00</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Per Pick</div>
                        <div class="stat-value" id="perPick">$1.00</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Picks Made</div>
                        <div class="stat-value" id="pickCount">0 / 63</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Max Payout</div>
                        <div class="stat-value highlight" id="maxPayout">$0.00</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Potential ROI</div>
                        <div class="stat-value highlight" id="roi">0%</div>
                    </div>
                </div>
                <div class="controls">
                    <div class="input-group" style="margin-right: 10px;">
                        <label class="input-label" style="color: rgba(255,255,255,0.7); font-size: 10px;">Entry Amount</label>
                        <input type="number" class="input-field" id="entryAmount" value="63" min="1" step="1" 
                               style="width: 100px; padding: 6px 10px; font-size: 14px;" 
                               onchange="updateEntryAmount()" onkeypress="if(event.key==='Enter') updateEntryAmount()">
                    </div>
                    <div class="input-group" style="margin-right: 10px;">
                        <label class="input-label" style="color: rgba(255,255,255,0.7); font-size: 10px;">Max Odds</label>
                        <select class="input-field" id="maxOdds" 
                                style="width: 100px; padding: 6px 10px; font-size: 13px; cursor: pointer;" 
                                onchange="updateMaxOdds()">
                            <option value="30">30-1</option>
                            <option value="50" selected>50-1</option>
                            <option value="100">100-1</option>
                        </select>
                    </div>
                    <div class="input-group" style="margin-right: 10px;">
                        <label class="input-label" style="color: rgba(255,255,255,0.7); font-size: 10px;">Pricing Model</label>
                        <select class="input-field" id="pricingModel" 
                                style="width: 160px; padding: 6px 10px; font-size: 13px; cursor: pointer;" 
                                onchange="updatePricingModel()">
                            <option value="flat">Flat Stakes</option>
                            <option value="progressive50">Progressive (+50%)</option>
                            <option value="progressive2x">Progressive (2x) üî•</option>
                        </select>
                    </div>
                    <button class="btn btn-auto" onclick="autoFillChalk()">Chalk</button>
                    <button class="btn btn-auto" style="background: #8b5cf6;" onclick="autoFillUpsetSpecial()">Upset Special</button>
                    <button class="btn btn-auto" style="background: #ef4444;" onclick="autoFillChaos()">Chaos</button>
                    <button class="btn btn-reset" onclick="resetBracket()">Reset</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="tab-content active" id="bracketTab">
        <div class="instructions">
            Click on teams to make your selections. Winning teams automatically advance to the next round. Watch the pricing update in real-time!
        </div>
        
        <div class="bracket-container">
            <div class="bracket-wrapper" id="bracketWrapper"></div>
        </div>
    </div>
    
    <div class="tab-content" id="probabilitiesTab">
        <div class="table-container">
            <div class="table-title">Historical Seed Performance & Pricing</div>
            <div class="table-subtitle">Based on March Madness historical data | Min 2% probability (50-1 max odds)</div>
            
            <table class="prob-table">
                <thead>
                    <tr>
                        <th>Seed</th>
                        <th>Round of 32<br><small>(Make Sweet 16)</small></th>
                        <th>Sweet 16<br><small>(Make Elite 8)</small></th>
                        <th>Elite 8<br><small>(Make Final 4)</small></th>
                        <th>Final Four<br><small>(Make Championship)</small></th>
                        <th>Championship<br><small>(Win Tournament)</small></th>
                    </tr>
                </thead>
                <tbody id="probTableBody">
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="tab-content" id="capitalTab">
        <div class="capital-container">
            <div class="capital-title">Market Maker Capital Requirements</div>
            <div class="capital-subtitle">Modeling SIG's exposure and collateral needs for Bet the Bracket</div>
            
            <div class="capital-section">
                <div class="section-header">üìä Single Bracket Economics by Pricing Model</div>
                
                <div style="margin-bottom: 20px; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3);">
                    <div style="font-size: 13px; color: #cbd5e1; line-height: 1.6;">
                        <strong>Entry Cost:</strong> Variable (default $63, can be $15, $50, $100, etc.)<br>
                        <strong>Per-Pick Stake:</strong> Depends on pricing model selected<br>
                        <strong>All contracts capped at 50-1 max odds</strong> (2% minimum probability)
                    </div>
                </div>
                
                <div class="capital-grid" style="grid-template-columns: repeat(3, 1fr);">
                    <div class="capital-card">
                        <div class="capital-card-label">Flat Stakes Model</div>
                        <div class="capital-description" style="margin-bottom: 10px;">Every pick costs same amount</div>
                        <div style="font-size: 12px; color: #94a3b8; line-height: 1.5;">
                            <strong>$63 Entry:</strong> $1.00/pick<br>
                            <strong>Chalk:</strong> ~$160 max<br>
                            <strong>Upset Special:</strong> ~$250 max<br>
                            <strong>Chaos:</strong> ~$2,800 max
                        </div>
                    </div>
                    
                    <div class="capital-card">
                        <div class="capital-card-label">Progressive +50% Model</div>
                        <div class="capital-description" style="margin-bottom: 10px;">Stakes grow 1.5x each round</div>
                        <div style="font-size: 12px; color: #94a3b8; line-height: 1.5;">
                            <strong>$63 Entry:</strong> $0.60-$4.55/pick<br>
                            <strong>Chalk:</strong> ~$126 max<br>
                            <strong>Upset Special:</strong> ~$400-500 max<br>
                            <strong>Chaos:</strong> ~$2,800 max
                        </div>
                    </div>
                    
                    <div class="capital-card" style="border-color: #ef4444;">
                        <div class="capital-card-label" style="color: #ef4444;">Progressive 2x Model üî•</div>
                        <div class="capital-description" style="margin-bottom: 10px;">Stakes double each round (R1‚ÜíR2‚ÜíS16‚ÜíE8‚ÜíF4‚ÜíChamp)</div>
                        <div style="font-size: 12px; color: #94a3b8; line-height: 1.5;">
                            <strong>$63 Entry:</strong> $0.33-$10.50/pick<br>
                            <strong>Chalk:</strong> ~$84 max<br>
                            <strong>Upset Special:</strong> ~$700-900 max<br>
                            <strong>Chaos:</strong> ~$2,800 max
                        </div>
                    </div>
                </div>
                
                <div class="formula-box">
                    <div class="formula-text">
                        <strong>How SIG Makes Money on Each Bracket:</strong><br><br>
                        ‚Ä¢ SIG is on the <strong>NO side</strong> of every YES position user takes<br>
                        ‚Ä¢ User pays entry amount upfront (e.g., $63, $15, etc.)<br>
                        ‚Ä¢ If user picks Duke YES to win, SIG has Duke NO<br>
                        ‚Ä¢ When Duke loses, SIG wins on ALL Duke advancement contracts<br>
                        ‚Ä¢ SIG's worst case = user's max payout (if bracket is perfect)<br>
                        ‚Ä¢ SIG's best case = user gets nothing right, SIG keeps full entry amount
                    </div>
                </div>
            </div>
            
            <div class="capital-section">
                <div class="section-header">üí∞ Aggregate Capital Requirements</div>
                
                <div class="scenario-input">
                    <div class="input-group">
                        <label class="input-label">Number of Brackets</label>
                        <input type="number" class="input-field" id="numBrackets" value="10000" min="100" step="1000" onchange="calculateAggregate()">
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">Avg Max Payout</label>
                        <input type="number" class="input-field" id="avgPayout" value="400" min="100" step="50" onchange="calculateAggregate()">
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">Entry Amount</label>
                        <select class="input-field" id="calcEntryAmount" onchange="calculateAggregate()" style="width: 100px;">
                            <option value="15">$15</option>
                            <option value="63" selected>$63</option>
                            <option value="100">$100</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-auto" onclick="calculateAggregate()">Calculate</button>
                </div>
                
                <div class="capital-grid">
                    <div class="capital-card">
                        <div class="capital-card-label">Naive Capital (No Netting)</div>
                        <div class="capital-card-value red" id="naiveCapital">$0</div>
                        <div class="capital-description">Total max payout √ó number of brackets</div>
                    </div>
                    
                    <div class="capital-card">
                        <div class="capital-card-label">Total Collected</div>
                        <div class="capital-card-value green" id="totalCollected">$0</div>
                        <div class="capital-description">$63 √ó number of brackets</div>
                    </div>
                    
                    <div class="capital-card">
                        <div class="capital-card-label">Naive Net Exposure</div>
                        <div class="capital-card-value red" id="naiveNet">$0</div>
                        <div class="capital-description">Worst case without correlation benefits</div>
                    </div>
                </div>
                
                <div class="formula-box" style="background: rgba(239, 68, 68, 0.1); border-left-color: #ef4444;">
                    <div class="formula-text">
                        <strong>‚ö†Ô∏è Why This Overstates Capital Requirements:</strong><br><br>
                        
                        The naive calculation assumes every bracket could simultaneously achieve max payout.<br>
                        This is impossible because:<br><br>
                        
                        1. <strong>Mutual Exclusivity:</strong> Only 1 team can win the championship<br>
                        2. <strong>Correlation:</strong> When Duke loses, ALL users with Duke positions lose together<br>
                        3. <strong>Natural Hedging:</strong> Users picking different champions offset each other<br><br>
                        
                        <strong>Actual capital needs are materially lower - see scenarios below ‚Üì</strong>
                    </div>
                </div>
            </div>
            
            <div class="capital-section">
                <div class="section-header">üéØ Example Netting Scenarios (Explicit Assumptions)</div>
                
                <div class="formula-box">
                    <div class="formula-text">
                        <strong>Scenario 1: Duke-Heavy Distribution</strong><br>
                        <em>Assumptions:</em><br>
                        ‚Ä¢ 10,000 total brackets<br>
                        ‚Ä¢ 60% pick Duke to win championship (6,000 brackets)<br>
                        ‚Ä¢ 40% pick Auburn to win championship (4,000 brackets)<br>
                        ‚Ä¢ Avg max payout per bracket: $350<br>
                        ‚Ä¢ All other picks relatively distributed<br><br>
                        
                        <strong>If Duke Wins Championship:</strong><br>
                        ‚Ä¢ SIG pays ~6,000 Duke brackets √ó $350 = <strong>$2.1M</strong><br>
                        ‚Ä¢ SIG already collected: 10,000 √ó $63 = $630K<br>
                        ‚Ä¢ SIG wins on Auburn advancement contracts in 4,000 brackets<br>
                        ‚Ä¢ <strong>SIG Net Exposure: ~$1.47M</strong> (before Auburn contract wins)<br><br>
                        
                        <strong>If Auburn Wins Championship:</strong><br>
                        ‚Ä¢ SIG pays ~4,000 Auburn brackets √ó $350 = <strong>$1.4M</strong><br>
                        ‚Ä¢ SIG already collected: $630K<br>
                        ‚Ä¢ SIG wins on Duke advancement contracts in 6,000 brackets<br>
                        ‚Ä¢ <strong>SIG Net Exposure: ~$770K</strong> (before Duke contract wins)<br><br>
                        
                        <strong>SIG's Worst Case:</strong> Duke wins scenario = $1.47M needed<br>
                        <em>(vs $3.5M naive - shows concentration reduces capital by ~58%)</em>
                    </div>
                </div>
                
                <div class="formula-box">
                    <div class="formula-text">
                        <strong>Scenario 2: Even Distribution</strong><br>
                        <em>Assumptions:</em><br>
                        ‚Ä¢ 10,000 total brackets<br>
                        ‚Ä¢ Champion picks evenly distributed across 8 teams (1,250 each)<br>
                        ‚Ä¢ Avg max payout per bracket: $350<br><br>
                        
                        <strong>Any Championship Outcome:</strong><br>
                        ‚Ä¢ Only 1,250 brackets have correct champion<br>
                        ‚Ä¢ SIG pays ~1,250 √ó $350 = <strong>$437.5K</strong><br>
                        ‚Ä¢ SIG collected: 10,000 √ó $63 = $630K<br>
                        ‚Ä¢ <strong>SIG Net: +$192.5K profit</strong> before accounting for partial wins<br><br>
                        
                        <em>This shows how pick distribution massively impacts capital needs</em>
                    </div>
                </div>
                
                <div class="formula-box">
                    <div class="formula-text">
                        <strong>Scenario 3: Absolute Worst Case (Chaos Bracket Hits)</strong><br>
                        <em>Assumptions:</em><br>
                        ‚Ä¢ 10,000 brackets<br>
                        ‚Ä¢ ALL users somehow pick identical chaos bracket (#16 seed wins)<br>
                        ‚Ä¢ Max payout per chaos bracket: ~$2,800 <strong>(Use "Auto-Fill Chaos" to verify exact)</strong><br><br>
                        
                        <strong>If That Exact Chaos Bracket Hits:</strong><br>
                        ‚Ä¢ SIG pays 10,000 √ó $2,800 = <strong>$28M</strong><br>
                        ‚Ä¢ SIG collected: $630K<br>
                        ‚Ä¢ <strong>SIG Net Exposure: $27.37M</strong><br><br>
                        
                        <em>‚ö†Ô∏è This scenario is virtually impossible - requires perfect coordination + 0.000001% outcome<br>
                        But represents absolute theoretical maximum if everyone picks same longshot bracket</em>
                    </div>
                </div>
            </div>
            
            <div class="capital-section">
                <div class="section-header">üé≤ Progressive Model Impact on Capital Requirements</div>
                
                <div class="formula-box" style="background: rgba(251, 191, 36, 0.1); border-left-color: #f59e0b;">
                    <div class="formula-text">
                        <strong>Key Insight: Progressive Models INCREASE Capital Requirements</strong><br><br>
                        
                        While flat stakes keeps payouts moderate, progressive models amplify upside on upset brackets:<br><br>
                        
                        <strong>Flat Stakes ($63 entry):</strong><br>
                        ‚Ä¢ #3 seed champion: ~$250 max payout<br>
                        ‚Ä¢ Realistic avg payout: $250-350<br><br>
                        
                        <strong>Progressive +50% ($63 entry):</strong><br>
                        ‚Ä¢ #3 seed champion: ~$400-500 max payout<br>
                        ‚Ä¢ Realistic avg payout: $350-500<br>
                        ‚Ä¢ <strong>~40-60% higher capital requirement</strong><br><br>
                        
                        <strong>Progressive 2x ($63 entry):</strong><br>
                        ‚Ä¢ #3 seed champion: ~$700-900 max payout<br>
                        ‚Ä¢ Realistic avg payout: $450-700<br>
                        ‚Ä¢ <strong>~80-140% higher capital requirement</strong><br><br>
                        
                        <em>Trade-off: Higher max payouts = better user excitement but requires more SIG capital commitment</em>
                    </div>
                </div>
            </div>
            
            <div class="capital-section">
                <div class="section-header">üìã What SIG Needs to Model</div>
                
                <div class="formula-box" style="background: rgba(59, 130, 246, 0.1); border-left-color: #3b82f6;">
                    <div class="formula-text">
                        <strong>Required Analysis to Determine Actual Capital Need:</strong><br><br>
                        
                        1. <strong>Choose Pricing Model (Business Decision)</strong><br>
                           ‚Ä¢ Flat stakes = simplest UX, lowest capital need<br>
                           ‚Ä¢ Progressive +50% = better excitement, moderate capital increase<br>
                           ‚Ä¢ Progressive 2x = maximum upside, highest capital requirement<br><br>
                        
                        2. <strong>Historical Bracket Distribution Data</strong><br>
                           ‚Ä¢ ESPN/Yahoo/CBS data: what % pick each team to win?<br>
                           ‚Ä¢ How concentrated are champion picks? (50% on Duke vs spread across 10 teams?)<br>
                           ‚Ä¢ What's distribution of chalk vs upset brackets?<br><br>
                        
                        3. <strong>Monte Carlo Simulation</strong><br>
                           ‚Ä¢ Model realistic bracket distributions based on historical data<br>
                           ‚Ä¢ Simulate 10,000+ tournament outcomes<br>
                           ‚Ä¢ For each outcome, calculate aggregate payout across all user brackets<br>
                           ‚Ä¢ Determine 95th/99th percentile capital requirement<br><br>
                        
                        4. <strong>Correlation & Netting Analysis</strong><br>
                           ‚Ä¢ When Duke loses in Elite 8, how many contracts across how many users resolve NO?<br>
                           ‚Ä¢ Quantify natural netting from opposing champion picks<br>
                           ‚Ä¢ Model correlation benefit (likely 40-70% reduction from naive)<br><br>
                        
                        5. <strong>Capital Buffer & Risk Management</strong><br>
                           ‚Ä¢ What confidence level does SIG require? (95%? 99%? 99.9%?)<br>
                           ‚Ä¢ How much cushion above modeled requirement?<br>
                           ‚Ä¢ Can capital be rebalanced between rounds as contracts settle?<br><br>
                        
                        <strong>Recommended Approach:</strong><br>
                        Start with Flat Stakes or Progressive +50% for feasibility, can always upgrade to 2x later if capital allows.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tournament data
        const teams = {
            east: [
                { name: "Duke", seed: 1, prob: 0.99 },
                { name: "Vermont", seed: 16, prob: 0.01 },
                { name: "Baylor", seed: 8, prob: 0.48 },
                { name: "Mississippi St", seed: 9, prob: 0.52 },
                { name: "Oregon", seed: 5, prob: 0.72 },
                { name: "Liberty", seed: 12, prob: 0.28 },
                { name: "Arizona", seed: 4, prob: 0.81 },
                { name: "Akron", seed: 13, prob: 0.19 },
                { name: "BYU", seed: 6, prob: 0.68 },
                { name: "VCU", seed: 11, prob: 0.32 },
                { name: "Wisconsin", seed: 3, prob: 0.89 },
                { name: "Montana", seed: 14, prob: 0.11 },
                { name: "Saint Mary's", seed: 7, prob: 0.62 },
                { name: "Vanderbilt", seed: 10, prob: 0.38 },
                { name: "Alabama", seed: 2, prob: 0.94 },
                { name: "Robert Morris", seed: 15, prob: 0.06 }
            ],
            south: [
                { name: "Auburn", seed: 1, prob: 0.98 },
                { name: "Alabama St", seed: 16, prob: 0.02 },
                { name: "Creighton", seed: 8, prob: 0.46 },
                { name: "Louisville", seed: 9, prob: 0.54 },
                { name: "Michigan", seed: 5, prob: 0.78 },
                { name: "UC San Diego", seed: 12, prob: 0.22 },
                { name: "Texas A&M", seed: 4, prob: 0.84 },
                { name: "Yale", seed: 13, prob: 0.16 },
                { name: "Ole Miss", seed: 6, prob: 0.71 },
                { name: "North Carolina", seed: 11, prob: 0.29 },
                { name: "Iowa St", seed: 3, prob: 0.87 },
                { name: "Lipscomb", seed: 14, prob: 0.13 },
                { name: "Marquette", seed: 7, prob: 0.64 },
                { name: "New Mexico", seed: 10, prob: 0.36 },
                { name: "Michigan St", seed: 2, prob: 0.92 },
                { name: "Bryant", seed: 15, prob: 0.08 }
            ],
            west: [
                { name: "Florida", seed: 1, prob: 0.97 },
                { name: "Norfolk St", seed: 16, prob: 0.03 },
                { name: "Oklahoma", seed: 8, prob: 0.44 },
                { name: "UConn", seed: 9, prob: 0.56 },
                { name: "Memphis", seed: 5, prob: 0.76 },
                { name: "Colorado St", seed: 12, prob: 0.24 },
                { name: "Maryland", seed: 4, prob: 0.82 },
                { name: "Grand Canyon", seed: 13, prob: 0.18 },
                { name: "Missouri", seed: 6, prob: 0.69 },
                { name: "Drake", seed: 11, prob: 0.31 },
                { name: "Texas Tech", seed: 3, prob: 0.88 },
                { name: "UNC Wilmington", seed: 14, prob: 0.12 },
                { name: "Kansas", seed: 7, prob: 0.65 },
                { name: "Arkansas", seed: 10, prob: 0.35 },
                { name: "St. John's", seed: 2, prob: 0.93 },
                { name: "Omaha", seed: 15, prob: 0.07 }
            ],
            midwest: [
                { name: "Houston", seed: 1, prob: 0.98 },
                { name: "SIU Edwardsville", seed: 16, prob: 0.02 },
                { name: "Georgia", seed: 8, prob: 0.49 },
                { name: "Gonzaga", seed: 9, prob: 0.51 },
                { name: "Purdue", seed: 5, prob: 0.79 },
                { name: "McNeese", seed: 12, prob: 0.21 },
                { name: "Clemson", seed: 4, prob: 0.83 },
                { name: "High Point", seed: 13, prob: 0.17 },
                { name: "Illinois", seed: 6, prob: 0.70 },
                { name: "Xavier", seed: 11, prob: 0.30 },
                { name: "Kentucky", seed: 3, prob: 0.90 },
                { name: "Troy", seed: 14, prob: 0.10 },
                { name: "Tennessee", seed: 7, prob: 0.66 },
                { name: "UCLA", seed: 10, prob: 0.34 },
                { name: "Tennessee", seed: 2, prob: 0.95 },
                { name: "Wofford", seed: 15, prob: 0.05 }
            ]
        };

        // Bracket state - stores all picks
        let bracket = {
            east: { round1: [], round2: [], sweet16: [], elite8: [], final4: null },
            south: { round1: [], round2: [], sweet16: [], elite8: [], final4: null },
            west: { round1: [], round2: [], sweet16: [], elite8: [], final4: null },
            midwest: { round1: [], round2: [], sweet16: [], elite8: [], final4: null },
            championship: { final: null, winner: null }
        };

        // Entry amount configuration
        let stakePerPick = 1.00; // Default $1 per pick (flat model)
        let pricingModel = 'flat'; // 'flat', 'progressive50', or 'progressive2x'
        let maxOdds = 50; // Max odds cap (30, 50, or 100)
        
        // Multipliers for 50% progressive model
        const multipliers50 = {
            round1: 1.00,
            round2: 1.50,
            sweet16: 2.25,
            elite8: 3.375,
            final4: 5.063,
            championship: 7.594
        };
        
        // Multipliers for 2x doubling model
        const multipliers2x = {
            round1: 1.00,
            round2: 2.00,
            sweet16: 4.00,
            elite8: 8.00,
            final4: 16.00,
            championship: 32.00
        };

        // Calculate base stake for progressive models
        // 50% model: 32√óbase + 16√ó(1.5base) + 8√ó(2.25base) + 4√ó(3.375base) + 2√ó(5.063base) + 1√ó(7.594base) = 105.22base
        // 2x model: 32√óbase + 16√ó(2base) + 8√ó(4base) + 4√ó(8base) + 2√ó(16base) + 1√ó(32base) = 32 + 32 + 32 + 32 + 32 + 32 = 192base
        function getStakeForRound(round, entryAmount) {
            if (pricingModel === 'flat') {
                return entryAmount / 63;
            } else if (pricingModel === 'progressive50') {
                const base = entryAmount / 105.22;
                return base * multipliers50[round];
            } else { // progressive2x
                const base = entryAmount / 192;
                return base * multipliers2x[round];
            }
        }

        function updatePricingModel() {
            pricingModel = document.getElementById('pricingModel').value;
            const entryAmount = parseFloat(document.getElementById('entryAmount').value) || 63;
            
            // Update display
            if (pricingModel === 'flat') {
                const flatStake = entryAmount / 63;
                document.getElementById('perPick').textContent = `$${flatStake.toFixed(3)}`;
            } else if (pricingModel === 'progressive50') {
                const r1Stake = getStakeForRound('round1', entryAmount);
                const champStake = getStakeForRound('championship', entryAmount);
                document.getElementById('perPick').textContent = `$${r1Stake.toFixed(2)}-${champStake.toFixed(2)}`;
            } else { // progressive2x
                const r1Stake = getStakeForRound('round1', entryAmount);
                const champStake = getStakeForRound('championship', entryAmount);
                document.getElementById('perPick').textContent = `$${r1Stake.toFixed(2)}-${champStake.toFixed(2)}`;
            }
            
            renderBracket();
            updateStats();
        }

        // Historical seed-based advancement probabilities (from March Madness data)
        // Column mapping: round2 = Sweet 16 column, sweet16 = Elite 8 column, etc.
        const seedProbabilities = {
            1: { round2: 0.846, sweet16: 0.660, elite8: 0.397, final4: 0.250, championship: 0.160 },
            2: { round2: 0.635, sweet16: 0.442, elite8: 0.205, final4: 0.083, championship: 0.032 },
            3: { round2: 0.526, sweet16: 0.256, elite8: 0.109, final4: 0.071, championship: 0.026 },
            4: { round2: 0.474, sweet16: 0.160, elite8: 0.096, final4: 0.026, championship: 0.013 },
            5: { round2: 0.346, sweet16: 0.077, elite8: 0.058, final4: 0.026, championship: 0.000 },
            6: { round2: 0.294, sweet16: 0.106, elite8: 0.019, final4: 0.013, championship: 0.006 },
            7: { round2: 0.181, sweet16: 0.063, elite8: 0.019, final4: 0.006, championship: 0.006 },
            8: { round2: 0.100, sweet16: 0.056, elite8: 0.038, final4: 0.025, championship: 0.006 },
            9: { round2: 0.050, sweet16: 0.031, elite8: 0.013, final4: 0.000, championship: 0.000 },
            10: { round2: 0.150, sweet16: 0.056, elite8: 0.006, final4: 0.000, championship: 0.000 },
            11: { round2: 0.169, sweet16: 0.063, elite8: 0.038, final4: 0.000, championship: 0.000 },
            12: { round2: 0.138, sweet16: 0.013, elite8: 0.000, final4: 0.000, championship: 0.000 },
            13: { round2: 0.038, sweet16: 0.000, elite8: 0.000, final4: 0.000, championship: 0.000 },
            14: { round2: 0.013, sweet16: 0.000, elite8: 0.000, final4: 0.000, championship: 0.000 },
            15: { round2: 0.025, sweet16: 0.006, elite8: 0.000, final4: 0.000, championship: 0.000 },
            16: { round2: 0.000, sweet16: 0.000, elite8: 0.000, final4: 0.000, championship: 0.000 }
        };

        // Helper function to get advancement probability for a team based on their seed and round
        function getAdvancementProb(seed, round) {
            const probs = seedProbabilities[seed];
            if (!probs) return 0.5; // fallback
            
            const roundMap = {
                'round2': 'round2',      // Making Sweet 16
                'sweet16': 'sweet16',    // Making Elite 8
                'elite8': 'elite8',      // Making Final 4
                'final4': 'final4',      // Making Championship
                'championship': 'championship' // Winning it all
            };
            
            return probs[roundMap[round]] || 0.01;
        }

        function calculatePayout(prob, stake) {
            // Cap based on selected max odds (30-1, 50-1, or 100-1)
            const minProb = 1 / maxOdds; // 30-1 = 0.0333, 50-1 = 0.02, 100-1 = 0.01
            const cappedProb = Math.max(prob, minProb);
            return stake / cappedProb;
        }

        function updateMaxOdds() {
            maxOdds = parseInt(document.getElementById('maxOdds').value) || 50;
            
            // Re-render bracket with new odds cap
            renderBracket();
            updateStats();
        }

        function updateEntryAmount() {
            const entryAmount = parseFloat(document.getElementById('entryAmount').value) || 63;
            
            // Update display
            document.getElementById('entryCost').textContent = `$${entryAmount.toFixed(2)}`;
            
            if (pricingModel === 'flat') {
                stakePerPick = entryAmount / 63;
                document.getElementById('perPick').textContent = `$${stakePerPick.toFixed(3)}`;
            } else {
                const r1Stake = getStakeForRound('round1', entryAmount);
                const champStake = getStakeForRound('championship', entryAmount);
                document.getElementById('perPick').textContent = `$${r1Stake.toFixed(2)}-${champStake.toFixed(2)}`;
            }
            
            // Re-render bracket with new pricing
            renderBracket();
            updateStats();
        }

        function selectTeam(region, round, matchupIdx, slotIdx) {
            const roundData = bracket[region][round];
            
            if (round === 'round1') {
                // Round 1: select from initial teams
                const teamIdx = matchupIdx * 2 + slotIdx;
                const team = teams[region][teamIdx];
                roundData[matchupIdx] = team;
            } else {
                // Later rounds: select from previous round winners
                const prevRound = getPreviousRound(round);
                const prevWinners = bracket[region][prevRound];
                const team1Idx = matchupIdx * 2;
                const team2Idx = matchupIdx * 2 + 1;
                
                if (slotIdx === 0 && prevWinners[team1Idx]) {
                    roundData[matchupIdx] = prevWinners[team1Idx];
                } else if (slotIdx === 1 && prevWinners[team2Idx]) {
                    roundData[matchupIdx] = prevWinners[team2Idx];
                }
            }
            
            // Clear all subsequent rounds in this region
            clearSubsequentRounds(region, round);
            
            renderBracket();
            updateStats();
        }

        function selectFinalFour(region, slotIdx) {
            const elite8Winners = bracket[region].elite8;
            if (elite8Winners[slotIdx]) {
                bracket[region].final4 = elite8Winners[slotIdx];
                clearChampionship();
                renderBracket();
                updateStats();
            }
        }

        function selectChampionship(slotIdx) {
            const regions = ['east', 'south', 'west', 'midwest'];
            const final4Teams = regions.map(r => bracket[r].final4).filter(t => t);
            
            if (final4Teams[slotIdx]) {
                bracket.championship.final = final4Teams[slotIdx];
                bracket.championship.winner = null;
                renderBracket();
                updateStats();
            }
        }

        function selectWinner(slotIdx) {
            const final = bracket.championship.final;
            // For now, just selecting the finalist as winner
            // In real scenario, would have 2 finalists to choose from
            if (final && slotIdx === 0) {
                bracket.championship.winner = final;
                renderBracket();
                updateStats();
            }
        }

        function getPreviousRound(round) {
            const order = ['round1', 'round2', 'sweet16', 'elite8', 'final4'];
            const idx = order.indexOf(round);
            return idx > 0 ? order[idx - 1] : null;
        }

        function clearSubsequentRounds(region, round) {
            const order = ['round1', 'round2', 'sweet16', 'elite8', 'final4'];
            const startIdx = order.indexOf(round) + 1;
            
            for (let i = startIdx; i < order.length; i++) {
                if (order[i] === 'final4') {
                    bracket[region].final4 = null;
                } else {
                    bracket[region][order[i]] = [];
                }
            }
            
            clearChampionship();
        }

        function clearChampionship() {
            bracket.championship = { final: null, winner: null };
        }

        function renderBracket() {
            const wrapper = document.getElementById('bracketWrapper');
            
            let html = '<div class="region-half">';
            html += renderRegion('east');
            html += renderRegion('south');
            html += '</div>';
            
            html += '<div class="final-four-section">';
            html += renderFinalFour();
            html += renderChampionship();
            html += '</div>';
            
            html += '<div class="region-half">';
            html += renderRegion('west');
            html += renderRegion('midwest');
            html += '</div>';
            
            wrapper.innerHTML = html;
        }

        function renderRound1(region) {
            const regionData = bracket[region];
            const regionTeams = teams[region];
            const entryAmount = parseFloat(document.getElementById('entryAmount').value) || 63;
            const stake = getStakeForRound('round1', entryAmount);
            
            let html = `<div class="round"><div class="round-label">Round 1 <span style="color: #10b981; font-weight: 700;">($${stake.toFixed(2)})</span></div>`;
            for (let i = 0; i < 8; i++) {
                const team1 = regionTeams[i * 2];
                const team2 = regionTeams[i * 2 + 1];
                const selected1 = regionData.round1[i]?.name === team1.name;
                const selected2 = regionData.round1[i]?.name === team2.name;
                
                html += `
                    <div class="matchup ${regionData.round1[i] ? 'selected' : ''}">
                        <div class="team-slot ${selected1 ? 'selected' : ''} ${selected2 ? 'locked' : ''}" onclick="selectTeam('${region}', 'round1', ${i}, 0)">
                            <div class="team-info">
                                <div class="seed">${team1.seed}</div>
                                <div class="team-name">${team1.name}</div>
                            </div>
                            <div class="pricing-info">
                                <div class="prob">${(team1.prob * 100).toFixed(0)}%</div>
                                <div class="payout">$${calculatePayout(team1.prob, stake).toFixed(2)}</div>
                            </div>
                        </div>
                        <div class="team-slot ${selected2 ? 'selected' : ''} ${selected1 ? 'locked' : ''}" onclick="selectTeam('${region}', 'round1', ${i}, 1)">
                            <div class="team-info">
                                <div class="seed">${team2.seed}</div>
                                <div class="team-name">${team2.name}</div>
                            </div>
                            <div class="pricing-info">
                                <div class="prob">${(team2.prob * 100).toFixed(0)}%</div>
                                <div class="payout">$${calculatePayout(team2.prob, stake).toFixed(2)}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            html += '</div>';
            return html;
        }

        function renderRegion(region) {
            const regionData = bracket[region];
            const regionTeams = teams[region];
            const isRightSide = region === 'west' || region === 'midwest';
            
            let html = `
                <div class="region">
                    <div class="region-header">${region.toUpperCase()}</div>
                    <div class="region-bracket">
            `;
            
            // For right side regions, render rounds in reverse order (Round 1 on far right)
            if (isRightSide) {
                // Elite 8 (1 game) - closest to center
                html += renderLaterRound(region, 'elite8', 1, 'Elite 8');
                
                // Sweet 16 (2 games)
                html += renderLaterRound(region, 'sweet16', 2, 'Sweet 16');
                
                // Round 2 (4 games)
                html += renderLaterRound(region, 'round2', 4, 'Round 2');
                
                // Round 1 (8 games) - far right
                html += renderRound1(region);
            } else {
                // Left side: normal order (Round 1 on far left)
                // Round 1 (8 games) - far left
                html += renderRound1(region);
                
                // Round 2 (4 games)
                html += renderLaterRound(region, 'round2', 4, 'Round 2');
                
                // Sweet 16 (2 games)
                html += renderLaterRound(region, 'sweet16', 2, 'Sweet 16');
                
                // Elite 8 (1 game) - closest to center
                html += renderLaterRound(region, 'elite8', 1, 'Elite 8');
            }
            
            html += '</div></div>';
            
            return html;
        }

        function renderLaterRound(region, round, numGames, label, fallbackProb) {
            const prevRound = getPreviousRound(round);
            const prevWinners = bracket[region][prevRound];
            const currentPicks = bracket[region][round];
            const entryAmount = parseFloat(document.getElementById('entryAmount').value) || 63;
            const stake = getStakeForRound(round, entryAmount);
            
            // Show multiplier for progressive mode
            let stakeDisplay = `($${stake.toFixed(2)})`;
            if (pricingModel === 'progressive50') {
                const multiplier = multipliers50[round];
                stakeDisplay = `($${stake.toFixed(2)} - ${multiplier.toFixed(2)}x)`;
            } else if (pricingModel === 'progressive2x') {
                const multiplier = multipliers2x[round];
                stakeDisplay = `($${stake.toFixed(2)} - ${multiplier.toFixed(0)}x)`;
            }
            
            let html = `<div class="round"><div class="round-label">${label} <span style="color: #10b981; font-weight: 700;">${stakeDisplay}</span></div>`;
            
            for (let i = 0; i < numGames; i++) {
                const team1 = prevWinners[i * 2];
                const team2 = prevWinners[i * 2 + 1];
                const selected1 = currentPicks[i]?.name === team1?.name;
                const selected2 = currentPicks[i]?.name === team2?.name;
                
                html += `<div class="matchup ${currentPicks[i] ? 'selected' : ''}">`;
                
                if (team1) {
                    const rawProb = getAdvancementProb(team1.seed, round);
                    const minProb = 1 / maxOdds;
                    const prob1 = Math.max(rawProb, minProb);
                    html += `
                        <div class="team-slot ${selected1 ? 'selected' : ''} ${selected2 ? 'locked' : ''}" onclick="selectTeam('${region}', '${round}', ${i}, 0)">
                            <div class="team-info">
                                <div class="seed">${team1.seed}</div>
                                <div class="team-name">${team1.name}</div>
                            </div>
                            <div class="pricing-info">
                                <div class="prob">${(prob1 * 100).toFixed(1)}%</div>
                                <div class="payout">$${calculatePayout(prob1, stake).toFixed(2)}</div>
                            </div>
                        </div>
                    `;
                } else {
                    html += '<div class="team-slot empty"><div class="placeholder">TBD</div></div>';
                }
                
                if (team2) {
                    const rawProb = getAdvancementProb(team2.seed, round);
                    const minProb = 1 / maxOdds;
                    const prob2 = Math.max(rawProb, minProb);
                    html += `
                        <div class="team-slot ${selected2 ? 'selected' : ''} ${selected1 ? 'locked' : ''}" onclick="selectTeam('${region}', '${round}', ${i}, 1)">
                            <div class="team-info">
                                <div class="seed">${team2.seed}</div>
                                <div class="team-name">${team2.name}</div>
                            </div>
                            <div class="pricing-info">
                                <div class="prob">${(prob2 * 100).toFixed(1)}%</div>
                                <div class="payout">$${calculatePayout(prob2, stake).toFixed(2)}</div>
                            </div>
                        </div>
                    `;
                } else {
                    html += '<div class="team-slot empty"><div class="placeholder">TBD</div></div>';
                }
                
                html += '</div>';
            }
            
            html += '</div>';
            return html;
        }

        function renderFinalFour() {
            const eastWinner = bracket.east.elite8[0];
            const southWinner = bracket.south.elite8[0];
            const westWinner = bracket.west.elite8[0];
            const midwestWinner = bracket.midwest.elite8[0];
            const entryAmount = parseFloat(document.getElementById('entryAmount').value) || 63;
            const stake = getStakeForRound('final4', entryAmount);
            
            const game1Selected1 = bracket.east.final4?.name === eastWinner?.name;
            const game1Selected2 = bracket.south.final4?.name === southWinner?.name;
            const game2Selected1 = bracket.west.final4?.name === westWinner?.name;
            const game2Selected2 = bracket.midwest.final4?.name === midwestWinner?.name;
            
            // Show multiplier for progressive mode
            let stakeDisplay = `$${stake.toFixed(2)}`;
            if (pricingModel === 'progressive50') {
                stakeDisplay = `$${stake.toFixed(2)} (5.06x)`;
            } else if (pricingModel === 'progressive2x') {
                stakeDisplay = `$${stake.toFixed(2)} (16x)`;
            }
            
            let html = `<div class="final-four-label">FINAL FOUR <div style="font-size: 14px; color: #10b981; margin-top: 5px;">${stakeDisplay}</div></div>`;
            
            // Game 1: East vs South
            html += `<div class="matchup ${bracket.east.final4 || bracket.south.final4 ? 'selected' : ''}">`;
            if (eastWinner) {
                const rawProb = getAdvancementProb(eastWinner.seed, 'final4');
                const minProb = 1 / maxOdds;
                const prob = Math.max(rawProb, minProb);
                html += `
                    <div class="team-slot ${game1Selected1 ? 'selected' : ''}" onclick="selectFinalFour('east', 0)">
                        <div class="team-info">
                            <div class="seed">${eastWinner.seed}</div>
                            <div class="team-name">${eastWinner.name}</div>
                        </div>
                        <div class="pricing-info">
                            <div class="prob">${(prob * 100).toFixed(1)}%</div>
                            <div class="payout">$${calculatePayout(prob, stake).toFixed(2)}</div>
                        </div>
                    </div>
                `;
            } else {
                html += '<div class="team-slot empty"><div class="placeholder">East Winner</div></div>';
            }
            
            if (southWinner) {
                const rawProb = getAdvancementProb(southWinner.seed, 'final4');
                const minProb = 1 / maxOdds;
                const prob = Math.max(rawProb, minProb);
                html += `
                    <div class="team-slot ${game1Selected2 ? 'selected' : ''}" onclick="selectFinalFour('south', 0)">
                        <div class="team-info">
                            <div class="seed">${southWinner.seed}</div>
                            <div class="team-name">${southWinner.name}</div>
                        </div>
                        <div class="pricing-info">
                            <div class="prob">${(prob * 100).toFixed(1)}%</div>
                            <div class="payout">$${calculatePayout(prob, stake).toFixed(2)}</div>
                        </div>
                    </div>
                `;
            } else {
                html += '<div class="team-slot empty"><div class="placeholder">South Winner</div></div>';
            }
            html += '</div>';
            
            // Game 2: West vs Midwest
            html += `<div class="matchup ${bracket.west.final4 || bracket.midwest.final4 ? 'selected' : ''}">`;
            if (westWinner) {
                const rawProb = getAdvancementProb(westWinner.seed, 'final4');
                const minProb = 1 / maxOdds;
                const prob = Math.max(rawProb, minProb);
                html += `
                    <div class="team-slot ${game2Selected1 ? 'selected' : ''}" onclick="selectFinalFour('west', 0)">
                        <div class="team-info">
                            <div class="seed">${westWinner.seed}</div>
                            <div class="team-name">${westWinner.name}</div>
                        </div>
                        <div class="pricing-info">
                            <div class="prob">${(prob * 100).toFixed(1)}%</div>
                            <div class="payout">$${calculatePayout(prob, stake).toFixed(2)}</div>
                        </div>
                    </div>
                `;
            } else {
                html += '<div class="team-slot empty"><div class="placeholder">West Winner</div></div>';
            }
            
            if (midwestWinner) {
                const rawProb = getAdvancementProb(midwestWinner.seed, 'final4');
                const minProb = 1 / maxOdds;
                const prob = Math.max(rawProb, minProb);
                html += `
                    <div class="team-slot ${game2Selected2 ? 'selected' : ''}" onclick="selectFinalFour('midwest', 0)">
                        <div class="team-info">
                            <div class="seed">${midwestWinner.seed}</div>
                            <div class="team-name">${midwestWinner.name}</div>
                        </div>
                        <div class="pricing-info">
                            <div class="prob">${(prob * 100).toFixed(1)}%</div>
                            <div class="payout">$${calculatePayout(prob, stake).toFixed(2)}</div>
                        </div>
                    </div>
                `;
            } else {
                html += '<div class="team-slot empty"><div class="placeholder">Midwest Winner</div></div>';
            }
            html += '</div>';
            
            return html;
        }

        function renderChampionship() {
            const finalist1 = bracket.east.final4 || bracket.south.final4;
            const finalist2 = bracket.west.final4 || bracket.midwest.final4;
            const champion = bracket.championship.winner;
            const entryAmount = parseFloat(document.getElementById('entryAmount').value) || 63;
            const stake = getStakeForRound('championship', entryAmount);
            
            // Show multiplier for progressive mode
            let stakeDisplay = `$${stake.toFixed(2)}`;
            if (pricingModel === 'progressive50') {
                stakeDisplay = `$${stake.toFixed(2)} (7.59x)`;
            } else if (pricingModel === 'progressive2x') {
                stakeDisplay = `$${stake.toFixed(2)} (32x) üî•`;
            }
            
            let html = '<div class="championship-game">';
            html += `<div class="round-label" style="margin-bottom: 15px;">CHAMPIONSHIP <span style="color: #10b981; font-weight: 700; font-size: 12px; display: block; margin-top: 3px;">${stakeDisplay}</span></div>`;
            
            html += `<div class="matchup">`;
            if (finalist1) {
                const rawProb = getAdvancementProb(finalist1.seed, 'championship');
                const minProb = 1 / maxOdds;
                const prob = Math.max(rawProb, minProb);
                html += `
                    <div class="team-slot ${bracket.championship.final?.name === finalist1.name ? 'selected' : ''}" onclick="selectChampionship(0)">
                        <div class="team-info">
                            <div class="seed">${finalist1.seed}</div>
                            <div class="team-name">${finalist1.name}</div>
                        </div>
                        <div class="pricing-info">
                            <div class="prob">${(prob * 100).toFixed(1)}%</div>
                            <div class="payout">$${calculatePayout(prob, stake).toFixed(2)}</div>
                        </div>
                    </div>
                `;
            } else {
                html += '<div class="team-slot empty"><div class="placeholder">Finalist 1</div></div>';
            }
            
            if (finalist2) {
                const rawProb = getAdvancementProb(finalist2.seed, 'championship');
                const minProb = 1 / maxOdds;
                const prob = Math.max(rawProb, minProb);
                html += `
                    <div class="team-slot ${bracket.championship.final?.name === finalist2.name ? 'selected' : ''}" onclick="selectChampionship(1)">
                        <div class="team-info">
                            <div class="seed">${finalist2.seed}</div>
                            <div class="team-name">${finalist2.name}</div>
                        </div>
                        <div class="pricing-info">
                            <div class="prob">${(prob * 100).toFixed(1)}%</div>
                            <div class="payout">$${calculatePayout(prob, stake).toFixed(2)}</div>
                        </div>
                    </div>
                `;
            } else {
                html += '<div class="team-slot empty"><div class="placeholder">Finalist 2</div></div>';
            }
            html += '</div>';
            
            if (champion) {
                const rawProb = getAdvancementProb(champion.seed, 'championship');
                const minProb = 1 / maxOdds;
                const winnerProb = Math.max(rawProb, minProb);
                html += `
                    <div class="champion-slot" style="margin-top: 15px;">
                        <div class="champion-label">2025 CHAMPION</div>
                        <div class="champion-team">${champion.name}</div>
                        <div class="pricing-info" style="align-items: center; margin-top: 8px;">
                            <div class="prob">${(winnerProb * 100).toFixed(1)}%</div>
                            <div class="payout">$${calculatePayout(winnerProb, stake).toFixed(2)}</div>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }

        function updateStats() {
            let totalPicks = 0;
            let totalPayout = 0;
            const entryAmount = parseFloat(document.getElementById('entryAmount').value) || 63;
            
            // Count all picks across all regions and rounds
            ['east', 'south', 'west', 'midwest'].forEach(region => {
                // Round 1 (32 total)
                const r1Stake = getStakeForRound('round1', entryAmount);
                totalPicks += bracket[region].round1.filter(t => t).length;
                bracket[region].round1.forEach(team => {
                    if (team) totalPayout += calculatePayout(team.prob, r1Stake);
                });
                
                // Round 2 (16 total) - use seed-specific probabilities
                const r2Stake = getStakeForRound('round2', entryAmount);
                bracket[region].round2.forEach(team => {
                    if (team) {
                        totalPicks++;
                        const rawProb = getAdvancementProb(team.seed, 'round2');
                        const minProb = 1 / maxOdds;
                        const prob = Math.max(rawProb, minProb);
                        totalPayout += calculatePayout(prob, r2Stake);
                    }
                });
                
                // Sweet 16 (8 total)
                const s16Stake = getStakeForRound('sweet16', entryAmount);
                bracket[region].sweet16.forEach(team => {
                    if (team) {
                        totalPicks++;
                        const rawProb = getAdvancementProb(team.seed, 'sweet16');
                        const minProb = 1 / maxOdds;
                        const prob = Math.max(rawProb, minProb);
                        totalPayout += calculatePayout(prob, s16Stake);
                    }
                });
                
                // Elite 8 (4 total)
                const e8Stake = getStakeForRound('elite8', entryAmount);
                bracket[region].elite8.forEach(team => {
                    if (team) {
                        totalPicks++;
                        const rawProb = getAdvancementProb(team.seed, 'elite8');
                        const minProb = 1 / maxOdds;
                        const prob = Math.max(rawProb, minProb);
                        totalPayout += calculatePayout(prob, e8Stake);
                    }
                });
            });
            
            // Final 4 semifinals (2 total picks, not 4!)
            // East vs South winner = 1 pick
            // West vs Midwest winner = 1 pick
            const f4Stake = getStakeForRound('final4', entryAmount);
            const minProb = 1 / maxOdds;
            
            if (bracket.east.final4 || bracket.south.final4) {
                totalPicks++;
                const f4Team = bracket.east.final4 || bracket.south.final4;
                const rawProb = getAdvancementProb(f4Team.seed, 'final4');
                const prob = Math.max(rawProb, minProb);
                totalPayout += calculatePayout(prob, f4Stake);
            }
            
            if (bracket.west.final4 || bracket.midwest.final4) {
                totalPicks++;
                const f4Team = bracket.west.final4 || bracket.midwest.final4;
                const rawProb = getAdvancementProb(f4Team.seed, 'final4');
                const prob = Math.max(rawProb, minProb);
                totalPayout += calculatePayout(prob, f4Stake);
            }
            
            // Championship finalist (1 total)
            const champStake = getStakeForRound('championship', entryAmount);
            if (bracket.championship.final) {
                totalPicks++;
                const rawProb = getAdvancementProb(bracket.championship.final.seed, 'championship');
                const prob = Math.max(rawProb, minProb);
                totalPayout += calculatePayout(prob, champStake);
            }
            
            // Note: We don't count championship.winner separately because it's the same pick
            // The "final" represents your pick to win it all
            
            // Update display
            document.getElementById('pickCount').textContent = `${totalPicks} / 63`;
            document.getElementById('maxPayout').textContent = `$${totalPayout.toFixed(2)}`;
            document.getElementById('entryCost').textContent = `$${entryAmount.toFixed(2)}`;
            
            if (pricingModel === 'flat') {
                document.getElementById('perPick').textContent = `$${(entryAmount/63).toFixed(3)}`;
            } else {
                const r1Stake = getStakeForRound('round1', entryAmount);
                const champStake = getStakeForRound('championship', entryAmount);
                document.getElementById('perPick').textContent = `$${r1Stake.toFixed(2)}-${champStake.toFixed(2)}`;
            }
            
            const roi = totalPicks > 0 ? ((totalPayout - entryAmount) / entryAmount * 100).toFixed(0) : 0;
            document.getElementById('roi').textContent = `${roi}%`;
        }

        function autoFillChalk() {
            // Round 1: pick all favorites (higher probability)
            ['east', 'south', 'west', 'midwest'].forEach(region => {
                for (let i = 0; i < 8; i++) {
                    const team1 = teams[region][i * 2];
                    const team2 = teams[region][i * 2 + 1];
                    bracket[region].round1[i] = team1.prob > team2.prob ? team1 : team2;
                }
            });
            
            // Round 2 and beyond: advance lower seed (better team)
            ['east', 'south', 'west', 'midwest'].forEach(region => {
                // Round 2: compare seeds from Round 1 winners
                for (let i = 0; i < 4; i++) {
                    const team1 = bracket[region].round1[i * 2];
                    const team2 = bracket[region].round1[i * 2 + 1];
                    if (team1 && team2) {
                        bracket[region].round2[i] = team1.seed < team2.seed ? team1 : team2;
                    } else if (team1) {
                        bracket[region].round2[i] = team1;
                    } else if (team2) {
                        bracket[region].round2[i] = team2;
                    }
                }
                
                // Sweet 16: compare seeds from Round 2 winners
                for (let i = 0; i < 2; i++) {
                    const team1 = bracket[region].round2[i * 2];
                    const team2 = bracket[region].round2[i * 2 + 1];
                    if (team1 && team2) {
                        bracket[region].sweet16[i] = team1.seed < team2.seed ? team1 : team2;
                    } else if (team1) {
                        bracket[region].sweet16[i] = team1;
                    } else if (team2) {
                        bracket[region].sweet16[i] = team2;
                    }
                }
                
                // Elite 8: compare seeds from Sweet 16 winners
                const team1 = bracket[region].sweet16[0];
                const team2 = bracket[region].sweet16[1];
                if (team1 && team2) {
                    bracket[region].elite8[0] = team1.seed < team2.seed ? team1 : team2;
                } else if (team1) {
                    bracket[region].elite8[0] = team1;
                } else if (team2) {
                    bracket[region].elite8[0] = team2;
                }
            });
            
            // Final Four: Pick winners from each semifinal (only 2 picks total)
            // Semifinal 1: East vs South
            if (bracket.east.elite8[0] && bracket.south.elite8[0]) {
                const eastWinner = bracket.east.elite8[0];
                const southWinner = bracket.south.elite8[0];
                if (eastWinner.seed < southWinner.seed) {
                    bracket.east.final4 = eastWinner;
                    bracket.south.final4 = null;
                } else {
                    bracket.south.final4 = southWinner;
                    bracket.east.final4 = null;
                }
            }
            
            // Semifinal 2: West vs Midwest
            if (bracket.west.elite8[0] && bracket.midwest.elite8[0]) {
                const westWinner = bracket.west.elite8[0];
                const midwestWinner = bracket.midwest.elite8[0];
                if (westWinner.seed < midwestWinner.seed) {
                    bracket.west.final4 = westWinner;
                    bracket.midwest.final4 = null;
                } else {
                    bracket.midwest.final4 = midwestWinner;
                    bracket.west.final4 = null;
                }
            }
            
            // Championship: pick lowest seed from the 2 finalists
            const finalist1 = bracket.east.final4 || bracket.south.final4;
            const finalist2 = bracket.west.final4 || bracket.midwest.final4;
            
            if (finalist1 && finalist2) {
                bracket.championship.final = finalist1.seed < finalist2.seed ? finalist1 : finalist2;
                bracket.championship.winner = finalist1.seed < finalist2.seed ? finalist1 : finalist2;
            }
            
            renderBracket();
            updateStats();
        }

        function autoFillChaos() {
            // Round 1: pick all underdogs (lower probability = higher seed number)
            ['east', 'south', 'west', 'midwest'].forEach(region => {
                for (let i = 0; i < 8; i++) {
                    const team1 = teams[region][i * 2];
                    const team2 = teams[region][i * 2 + 1];
                    bracket[region].round1[i] = team1.prob < team2.prob ? team1 : team2;
                }
            });
            
            // Round 2 and beyond: advance HIGHER seed (worse team - chaos!)
            ['east', 'south', 'west', 'midwest'].forEach(region => {
                // Round 2: pick worse team
                for (let i = 0; i < 4; i++) {
                    const team1 = bracket[region].round1[i * 2];
                    const team2 = bracket[region].round1[i * 2 + 1];
                    if (team1 && team2) {
                        // Pick higher seed number (worse team)
                        bracket[region].round2[i] = team1.seed > team2.seed ? team1 : team2;
                    } else if (team1) {
                        bracket[region].round2[i] = team1;
                    } else if (team2) {
                        bracket[region].round2[i] = team2;
                    }
                }
                
                // Sweet 16: pick worse team
                for (let i = 0; i < 2; i++) {
                    const team1 = bracket[region].round2[i * 2];
                    const team2 = bracket[region].round2[i * 2 + 1];
                    if (team1 && team2) {
                        bracket[region].sweet16[i] = team1.seed > team2.seed ? team1 : team2;
                    } else if (team1) {
                        bracket[region].sweet16[i] = team1;
                    } else if (team2) {
                        bracket[region].sweet16[i] = team2;
                    }
                }
                
                // Elite 8: pick worse team
                const team1 = bracket[region].sweet16[0];
                const team2 = bracket[region].sweet16[1];
                if (team1 && team2) {
                    bracket[region].elite8[0] = team1.seed > team2.seed ? team1 : team2;
                } else if (team1) {
                    bracket[region].elite8[0] = team1;
                } else if (team2) {
                    bracket[region].elite8[0] = team2;
                }
            });
            
            // Final Four: Pick winners from each semifinal (only 2 picks total)
            // Semifinal 1: East vs South - pick worse team
            if (bracket.east.elite8[0] && bracket.south.elite8[0]) {
                const eastWinner = bracket.east.elite8[0];
                const southWinner = bracket.south.elite8[0];
                if (eastWinner.seed > southWinner.seed) {
                    bracket.east.final4 = eastWinner;
                    bracket.south.final4 = null;
                } else {
                    bracket.south.final4 = southWinner;
                    bracket.east.final4 = null;
                }
            }
            
            // Semifinal 2: West vs Midwest - pick worse team
            if (bracket.west.elite8[0] && bracket.midwest.elite8[0]) {
                const westWinner = bracket.west.elite8[0];
                const midwestWinner = bracket.midwest.elite8[0];
                if (westWinner.seed > midwestWinner.seed) {
                    bracket.west.final4 = westWinner;
                    bracket.midwest.final4 = null;
                } else {
                    bracket.midwest.final4 = midwestWinner;
                    bracket.west.final4 = null;
                }
            }
            
            // Championship: pick highest seed (worst team) from the 2 finalists
            const finalist1 = bracket.east.final4 || bracket.south.final4;
            const finalist2 = bracket.west.final4 || bracket.midwest.final4;
            
            if (finalist1 && finalist2) {
                bracket.championship.final = finalist1.seed > finalist2.seed ? finalist1 : finalist2;
                bracket.championship.winner = finalist1.seed > finalist2.seed ? finalist1 : finalist2;
            }
            
            renderBracket();
            updateStats();
        }

        function autoFillUpsetSpecial() {
            // Upset Special: Strategic bracket with #3 seed champion
            // Goal: Show progressive model benefit (small R1 stakes, big championship stake on 2.6% outcome)
            
            ['east', 'south', 'west', 'midwest'].forEach((region, regionIdx) => {
                // Round 1: Mostly chalk with 1-2 strategic upsets
                for (let i = 0; i < 8; i++) {
                    const team1 = teams[region][i * 2];
                    const team2 = teams[region][i * 2 + 1];
                    
                    // Pick a 12-seed upset (index 2) to add flavor
                    if (i === 2) {
                        bracket[region].round1[i] = team1.prob < team2.prob ? team1 : team2;
                    } else {
                        bracket[region].round1[i] = team1.prob > team2.prob ? team1 : team2;
                    }
                }
                
                // Round 2: Set up #1 vs #3 in Elite 8 by advancing both through Sweet 16
                for (let i = 0; i < 4; i++) {
                    const team1 = bracket[region].round1[i * 2];
                    const team2 = bracket[region].round1[i * 2 + 1];
                    if (team1 && team2) {
                        // Advance the better seed (will typically be #1 and #3 on opposite sides)
                        bracket[region].round2[i] = team1.seed < team2.seed ? team1 : team2;
                    } else {
                        bracket[region].round2[i] = team1 || team2;
                    }
                }
                
                // Sweet 16: Force #3 seeds through in East and South
                for (let i = 0; i < 2; i++) {
                    const team1 = bracket[region].round2[i * 2];
                    const team2 = bracket[region].round2[i * 2 + 1];
                    if (team1 && team2) {
                        // In East and South: pick HIGHER seed number (picks #3 or #4 over #1 or #2)
                        if (region === 'east' || region === 'south') {
                            bracket[region].sweet16[i] = team1.seed > team2.seed ? team1 : team2;
                        } else {
                            // West and Midwest: chalk
                            bracket[region].sweet16[i] = team1.seed < team2.seed ? team1 : team2;
                        }
                    } else {
                        bracket[region].sweet16[i] = team1 || team2;
                    }
                }
                
                // Elite 8: Force #3 seeds through in East and South
                const team1 = bracket[region].sweet16[0];
                const team2 = bracket[region].sweet16[1];
                if (team1 && team2) {
                    // In East and South: pick HIGHER seed number (should be #3)
                    if (region === 'east' || region === 'south') {
                        bracket[region].elite8[0] = team1.seed > team2.seed ? team1 : team2;
                    } else {
                        // West and Midwest: chalk
                        bracket[region].elite8[0] = team1.seed < team2.seed ? team1 : team2;
                    }
                } else {
                    bracket[region].elite8[0] = team1 || team2;
                }
            });
            
            // Final Four: Pick winners from each semifinal (only 2 picks total)
            // Semifinal 1: East vs South - pick the #3 seed if available, otherwise chalk
            if (bracket.east.elite8[0] && bracket.south.elite8[0]) {
                const eastWinner = bracket.east.elite8[0];
                const southWinner = bracket.south.elite8[0];
                // Pick the #3 seed if one exists
                if (eastWinner.seed === 3) {
                    bracket.east.final4 = eastWinner;
                    bracket.south.final4 = null;
                } else if (southWinner.seed === 3) {
                    bracket.south.final4 = southWinner;
                    bracket.east.final4 = null;
                } else if (eastWinner.seed < southWinner.seed) {
                    bracket.east.final4 = eastWinner;
                    bracket.south.final4 = null;
                } else {
                    bracket.south.final4 = southWinner;
                    bracket.east.final4 = null;
                }
            }
            
            // Semifinal 2: West vs Midwest - pick chalk (lower seed)
            if (bracket.west.elite8[0] && bracket.midwest.elite8[0]) {
                const westWinner = bracket.west.elite8[0];
                const midwestWinner = bracket.midwest.elite8[0];
                if (westWinner.seed < midwestWinner.seed) {
                    bracket.west.final4 = westWinner;
                    bracket.midwest.final4 = null;
                } else {
                    bracket.midwest.final4 = midwestWinner;
                    bracket.west.final4 = null;
                }
            }
            
            // Championship: Pick the #3 seed as champion
            const finalist1 = bracket.east.final4 || bracket.south.final4;
            const finalist2 = bracket.west.final4 || bracket.midwest.final4;
            
            // Pick #3 seed if available, otherwise best available
            const champion = (finalist1 && finalist1.seed === 3) ? finalist1 :
                           (finalist2 && finalist2.seed === 3) ? finalist2 :
                           finalist1; // fallback
            
            bracket.championship.final = champion;
            bracket.championship.winner = champion;
            
            renderBracket();
            updateStats();
        }

        function resetBracket() {
            bracket = {
                east: { round1: [], round2: [], sweet16: [], elite8: [], final4: null },
                south: { round1: [], round2: [], sweet16: [], elite8: [], final4: null },
                west: { round1: [], round2: [], sweet16: [], elite8: [], final4: null },
                midwest: { round1: [], round2: [], sweet16: [], elite8: [], final4: null },
                championship: { final: null, winner: null }
            };
            
            renderBracket();
            updateStats();
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            if (tabName === 'bracket') {
                document.getElementById('bracketTab').classList.add('active');
            } else if (tabName === 'probabilities') {
                document.getElementById('probabilitiesTab').classList.add('active');
            } else if (tabName === 'capital') {
                document.getElementById('capitalTab').classList.add('active');
                calculateAggregate(); // Auto-calculate when switching to this tab
            }
        }

        function calculateAggregate() {
            const numBrackets = parseInt(document.getElementById('numBrackets').value) || 10000;
            const avgPayout = parseInt(document.getElementById('avgPayout').value) || 400;
            const entryAmount = parseInt(document.getElementById('calcEntryAmount')?.value) || 63;
            
            // Naive calculation
            const naiveCapital = numBrackets * avgPayout;
            const totalCollected = numBrackets * entryAmount;
            const naiveNet = naiveCapital - totalCollected;
            
            // Update display
            document.getElementById('naiveCapital').textContent = `$${naiveCapital.toLocaleString()}`;
            document.getElementById('totalCollected').textContent = `$${totalCollected.toLocaleString()}`;
            document.getElementById('naiveNet').textContent = `$${naiveNet.toLocaleString()}`;
        }

        function renderProbabilityTable() {
            const tbody = document.getElementById('probTableBody');
            
            // Data from CSV with 2% floor applied
            const tableData = [
                { seed: 1, round2: 84.6, sweet16: 66.0, elite8: 39.7, final4: 25.0, championship: 16.0 },
                { seed: 2, round2: 63.5, sweet16: 44.2, elite8: 20.5, final4: 8.3, championship: 3.2 },
                { seed: 3, round2: 52.6, sweet16: 25.6, elite8: 10.9, final4: 7.1, championship: 2.6 },
                { seed: 4, round2: 47.4, sweet16: 16.0, elite8: 9.6, final4: 2.6, championship: 2.0 },
                { seed: 5, round2: 34.6, sweet16: 7.7, elite8: 5.8, final4: 2.6, championship: 2.0 },
                { seed: 6, round2: 29.4, sweet16: 10.6, elite8: 2.0, final4: 2.0, championship: 2.0 },
                { seed: 7, round2: 18.1, sweet16: 6.3, elite8: 2.0, final4: 2.0, championship: 2.0 },
                { seed: 8, round2: 10.0, sweet16: 5.6, elite8: 3.8, final4: 2.5, championship: 2.0 },
                { seed: 9, round2: 5.0, sweet16: 3.1, elite8: 2.0, final4: 2.0, championship: 2.0 },
                { seed: 10, round2: 15.0, sweet16: 5.6, elite8: 2.0, final4: 2.0, championship: 2.0 },
                { seed: 11, round2: 16.9, sweet16: 6.3, elite8: 3.8, final4: 2.0, championship: 2.0 },
                { seed: 12, round2: 13.8, sweet16: 2.0, elite8: 2.0, final4: 2.0, championship: 2.0 },
                { seed: 13, round2: 3.8, sweet16: 2.0, elite8: 2.0, final4: 2.0, championship: 2.0 },
                { seed: 14, round2: 2.0, sweet16: 2.0, elite8: 2.0, final4: 2.0, championship: 2.0 },
                { seed: 15, round2: 2.5, sweet16: 2.0, elite8: 2.0, final4: 2.0, championship: 2.0 },
                { seed: 16, round2: 2.0, sweet16: 2.0, elite8: 2.0, final4: 2.0, championship: 2.0 }
            ];
            
            let html = '';
            tableData.forEach(row => {
                const isCapped = row.seed >= 12; // Seeds that hit the 2% floor
                html += `<tr>`;
                html += `<td class="seed-col">#${row.seed}</td>`;
                
                // Round of 32 (Making Sweet 16)
                html += `<td>
                    <div class="prob-cell ${row.round2 === 2.0 ? 'capped' : ''}">${row.round2.toFixed(1)}%</div>
                    <div class="payout-cell">$${(1 / (row.round2 / 100)).toFixed(2)}</div>
                </td>`;
                
                // Sweet 16 (Making Elite 8)
                html += `<td>
                    <div class="prob-cell ${row.sweet16 === 2.0 ? 'capped' : ''}">${row.sweet16.toFixed(1)}%</div>
                    <div class="payout-cell">$${(1 / (row.sweet16 / 100)).toFixed(2)}</div>
                </td>`;
                
                // Elite 8 (Making Final 4)
                html += `<td>
                    <div class="prob-cell ${row.elite8 === 2.0 ? 'capped' : ''}">${row.elite8.toFixed(1)}%</div>
                    <div class="payout-cell">$${(1 / (row.elite8 / 100)).toFixed(2)}</div>
                </td>`;
                
                // Final 4 (Making Championship)
                html += `<td>
                    <div class="prob-cell ${row.final4 === 2.0 ? 'capped' : ''}">${row.final4.toFixed(1)}%</div>
                    <div class="payout-cell">$${(1 / (row.final4 / 100)).toFixed(2)}</div>
                </td>`;
                
                // Championship (Winning)
                html += `<td>
                    <div class="prob-cell ${row.championship === 2.0 ? 'capped' : ''}">${row.championship.toFixed(1)}%</div>
                    <div class="payout-cell">$${(1 / (row.championship / 100)).toFixed(2)}</div>
                </td>`;
                
                html += `</tr>`;
            });
            
            tbody.innerHTML = html;
        }
        
        // Initialize
        renderBracket();
        renderProbabilityTable();
        updateStats();
    </script>
</body>
</html>
